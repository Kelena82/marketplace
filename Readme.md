## Моделирование класса покупательской активности клиента

**Постановка задачи: требуется разработать модель, которая определит вероятность покупательской активности клиента, на основе которой можно определить класс покупательской активности клиента (не купит / купит).**   

* В основных данных приводится информация об  истории покупок,  истории рекламных рассылок, разметка с классом покупателя,  агрегация общей базы рассылок по дням и типам событий, агрегация по дням с учетом событий и каналов рассылки. Исходные данные не содержат пропусков. Дубликаты строк в таблицах с покупками и рассылками были удалены. Идентификаторы товаров обработаны: были выделены категории первого уровня, а также категории первых двух уровней и остальных уровней.   
* Анализ данных показал, что в среднем клиент тратит меньше денег на покупки со вторника по четверг, сумма покупки растет с пятницы по понедельник. Наиболее покупаемой является категория 4 для первого уровня, затем 2, 5562. В разрезе каналов рассылки доля класса 1 через mobile_push чуть выше по сравнению с email. Клиенты класса 1 имеют чуть выше долю событий: subscribe, click, open, purchase. Это говорит о необходимости создания синтетических признаков на основе каналов рассылки и действий с сообщениями.   
* Данные представлены таблицами разных форматов. Таблицы были объединены с учетом данных, по которым производилась разметка. В результате данные были агрегированы по колонке с идентификатором клиента и созданием новых дополительных агрегированных признаков на основе исходных. В результате объединения образовавшиеся пропуски были заполнены пустым значением и нулем.
* При объединении таблиц были созданы следующие агрегирующие данные по каждому клиенту: первоначальная дата покупки, последняя дата покупки, общая сумма покупки, количество уникальных категорий первого уровня для клиента, количество и сумма покупок в разрезе месяцев и лет, а также количество и сумма покупок в разрезе категорий первого уровня, первых двух уровней, наиболее частый день покупки для каждого клиента, наиболее частые идентификаторы сообщений для определенного клиента, а также идентификатор рассылки. Для каждого клиента также были получены количество каналов email и mobile_push, а также количество различных действий с сообщениями.
* Корреляционный анализ с ипсользованием phik показал, что показатели со сроками и количествами различных событий более остальных влияют на целевую переменную, не считая идентификатора сообщений, что определило создания синтетических столбцов на их основе.   
* Были созданы синтетические столбцы со средневзвешенными сроками: обычным и дисконтированным. В качестве весов взяты суммы покупок по месяцам. Для средневзвешенных дисконтированных сроков использовался приближенный расчет. В качестве ставки дисконтирования взята ставка 1% за месяц. Здесь является открытым вопрос выбора ставки дисконтирования. В теории ее принимают равной безрисковой ставке плюс поправка за риск (значение выбирается также с учетом периода времени - год, месяц).
* При моделировании вероятности класса клиента использовался CatBoostClassifier. В классах имеется сильный дисбаланс (не купят - 98%, купят - 2%). Обычно в таких задачах используют метрику f1, так как эта метрика учитывает дисбаланс классов (является средним гармоническим между precision и recall, то есть ближе к меньшему из них). По техническому заданию требуется использовать метрику roc_auc, которая определяет производительность модели при различных пороговых значениях. Однако в случае дисбаланса данная метрика редко используется, так как может маскировать низкую эффективность модели.
* roc_auc на валидационной выборке 0.82, на тестовой - 0.83.
* Анализ важности признаков показал, что наиболее сильное влияние на предсказание модели оказывают: идентификатор рассылки, количество кликов в 2024 году, произведение среднего чека на продолжительность между последней и первой датами покупок, разница между последней и первой датами покупок, количество важных событий (open, click, purchase) в 2024 году, разница между датой выгрузки и последней датой покупки, количество каналов mobile_push, средневзвешенный дисконтированный срок, где в качестве весов выступают суммы важных событий (open, click, purchase), средневзвешенный дисконтированный срок с весами в виде количества покупок.
* На основе модели определен класс покупателя, что может помочь бинесу для оптимизации процессов работы с покупателями.